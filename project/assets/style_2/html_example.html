<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Goals Cards</title>
    <style>
        body {
            margin: 0;
            padding: 2rem;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Grid container */
        .cards-container {
            display: grid;
            gap: clamp(2rem, 4vw, 5rem);
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Each card with strict aspect ratio and container queries */
        .card {
            aspect-ratio: 4 / 5; /* 1080:1350 = 4:5 */
            container-type: size; /* Enable container queries */
            display: grid;
            grid-template-rows: 1fr auto; /* content + footer */
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: clamp(12px, 2cqmin, 24px);
            box-shadow: 0 clamp(4px, 1cqmin, 12px) clamp(20px, 4cqmin, 40px) rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        /* Content area */
        .content {
            padding: clamp(24px, 5cqmin, 80px) clamp(18px, 4cqmin, 60px) 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: clamp(12px, 2.5cqmin, 40px);
            font-size: clamp(14px, 2.8cqmin, 47px);
            line-height: 1.5;
        }

        /* Title card specific layout */
        .title-card .content {
            align-items: center;
            justify-content: space-between;
            text-align: center;
        }

        /* Typography */
        .header-text {
            font-size: clamp(1.4em, 5.5cqmin, 2.2em);
            font-weight: 800;
            color: #2c3e50;
            line-height: 1.2;
            letter-spacing: -0.02em;
            margin: 0;
        }

        .card-header {
            font-size: clamp(1.1em, 4.2cqmin, 1.6em);
            font-weight: 700;
            color: #2c3e50;
            line-height: 1.3;
            margin: 0 0 clamp(16px, 3cqmin, 32px) 0;
            text-align: left;
        }

        .section-number {
            font-size: clamp(1.0em, 3.2cqmin, 1.4em);
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 clamp(6px, 1.2cqmin, 18px) 0;
            line-height: 1.3;
        }

        .section-title {
            font-size: clamp(1.0em, 3.2cqmin, 1.4em);
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 clamp(8px, 1.5cqmin, 20px) 0;
            line-height: 1.3;
        }

        .section-content, .section-text {
            font-size: clamp(0.85em, 2.2cqmin, 1.1em);
            font-weight: 300;
            color: #34495e;
            margin: 0 0 clamp(12px, 2cqmin, 32px) 0;
            line-height: 1.5;
        }

        .section {
            margin-bottom: clamp(20px, 4cqmin, 60px);
        }

        .section:last-child {
            margin-bottom: 0;
        }

        /* Mountain illustration */
        .illustration {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
        }

        .mountain-scene {
            width: clamp(200px, 45cqmin, 600px);
            height: clamp(133px, 30cqmin, 400px);
            position: relative;
        }

        .mountain-svg {
            width: 100%;
            height: 100%;
        }

        /* Author section */
        .author-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: clamp(8px, 2cqmin, 24px);
            padding: clamp(16px, 3cqmin, 40px) clamp(18px, 4cqmin, 60px) clamp(20px, 4cqmin, 60px);
            background: linear-gradient(to top, 
                rgba(248, 249, 250, 1) 70%, 
                rgba(248, 249, 250, 0.8) 85%,
                rgba(248, 249, 250, 0) 100%);
            position: relative;
            z-index: 10;
        }

        .divider {
            width: clamp(120px, 30cqmin, 400px);
            height: clamp(2px, 0.5cqmin, 6px);
            background: #bdc3c7;
            margin-bottom: clamp(4px, 1cqmin, 16px);
        }

        .author-name {
            font-size: clamp(12px, 2.5cqmin, 32px);
            color: #34495e;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: clamp(4px, 1cqmin, 16px);
            margin: 0;
        }

        .verified-icon {
            color: #1da1f2;
            font-size: 1em;
        }

        .author-avatar {
            width: clamp(24px, 6cqmin, 80px);
            height: clamp(24px, 6cqmin, 80px);
            background-image: url('https://i.postimg.cc/bwh3wSnq/553042825-17844380376578084-4981825539930091566-n.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 50%;
            margin-top: clamp(4px, 1cqmin, 12px);
            box-shadow: 0 clamp(1px, 0.3cqmin, 3px) clamp(4px, 1cqmin, 12px) rgba(0, 0, 0, 0.2);
        }

        /* Control buttons */
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .download-btn {
            background: #27ae60;
        }

        .download-btn:hover {
            background: #219a52;
            transform: translateY(-2px);
        }

        .edit-toggle-btn {
            background: #f39c12;
        }

        .edit-toggle-btn:hover {
            background: #d68910;
            transform: translateY(-2px);
        }

        .edit-toggle-btn.active {
            background: #e74c3c;
        }

        /* Edit functionality */
        .editable {
            cursor: text;
            transition: background-color 0.2s ease;
            padding: clamp(2px, 0.5cqmin, 4px);
            border-radius: clamp(2px, 0.5cqmin, 4px);
        }

        .editable:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }

        .editable:focus {
            outline: clamp(1px, 0.3cqmin, 2px) solid #667eea;
            background-color: rgba(102, 126, 234, 0.05);
        }

        .edit-mode-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: none;
            z-index: 1000;
        }

        .edit-mode-indicator.active {
            display: block;
        }
    </style>
</head>
<body>
<div class="cards-container">

    <!--        THERE IS A PLACE WHERE DYNAMIC CARDS SHOULD BE INSERTED  -->


    <div class="controls">
    <button class="control-btn edit-toggle-btn" id="editToggleBtn" onclick="toggleEditMode()">
        ✏️ Edytuj tekst
    </button>
    <button class="control-btn download-btn" onclick="downloadCard(1)">
        📥 Pobierz kartę 1
    </button>
    <button class="control-btn download-btn" onclick="downloadCard(2)">
        📥 Pobierz kartę 2
    </button>
    <button class="control-btn download-btn" onclick="downloadCard(3)">
        📥 Pobierz kartę 3
    </button>
    <button class="control-btn download-btn" onclick="downloadCard(4)">
        📥 Pobierz kartę 4
    </button>
    <button class="control-btn download-btn" onclick="downloadCard(5)">
        📥 Pobierz kartę 5
    </button>
    <button class="control-btn download-btn" onclick="downloadCard(6)">
        📥 Pobierz kartę 6
    </button>
    <button class="control-btn download-btn" onclick="downloadCard(7)">
        📥 Pobierz kartę 7
    </button>
    </div>
    
    <div class="edit-mode-indicator" id="editModeIndicator">
        Tryb edycji włączony - kliknij na tekst aby edytować
    </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module">
        // Import html-to-image from CDN
        import { toPng } from 'https://cdn.skypack.dev/html-to-image@1.11.11';
        window.toPng = toPng;
        
    // Optimized image generation function with complete style matching
        window.generateCardImage = async function(card, options = {}) {
            const defaultOptions = {
                width: 1080,
                height: 1350,
                backgroundColor: '#ffffff',
            pixelRatio: 2
            };
            
            const finalOptions = { ...defaultOptions, ...options };
            
            // Store original styles
            const originalStyles = {
                position: card.style.position,
                left: card.style.left,
                top: card.style.top,
                transform: card.style.transform,
                transformOrigin: card.style.transformOrigin,
                overflow: card.style.overflow,
            boxSizing: card.style.boxSizing,
            width: card.style.width,
            height: card.style.height
            };
            
            try {
            // Set card to exact target dimensions to maintain container query scaling
            card.style.width = finalOptions.width + 'px';
            card.style.height = finalOptions.height + 'px';
                card.style.position = 'absolute';
                card.style.left = '0px';
                card.style.top = '0px';
                card.style.transform = 'none';
                card.style.transformOrigin = 'top left';
                card.style.overflow = 'hidden';
                card.style.boxSizing = 'border-box';
                
            // Force layout recalculation for container queries
            card.offsetHeight; // Trigger reflow
            
            // Wait for layout to settle and container queries to recalculate
            await new Promise(resolve => setTimeout(resolve, 200));
            
                const canvas = await html2canvas(card, {
                backgroundColor: '#ffffff',
                    scale: finalOptions.pixelRatio,
                    useCORS: true,
                    allowTaint: true,
                    width: finalOptions.width,
                    height: finalOptions.height,
                    scrollX: 0,
                    scrollY: 0,
                    logging: false,
                    removeContainer: false,
                foreignObjectRendering: false,
                letterRendering: true,
                dpi: 300,
                    onclone: function(clonedDoc) {
                    // Ensure body and card have white background
                        clonedDoc.body.style.backgroundColor = '#ffffff';
                        clonedDoc.body.style.background = '#ffffff';
                        
                    // Find the cloned card and ensure it has the correct dimensions
                    const clonedCard = clonedDoc.querySelector('.card');
                    if (clonedCard) {
                        // Maintain exact dimensions for container queries
                        clonedCard.style.width = finalOptions.width + 'px';
                        clonedCard.style.height = finalOptions.height + 'px';
                        clonedCard.style.backgroundColor = '#ffffff';
                        clonedCard.style.background = '#ffffff';
                        clonedCard.style.backgroundImage = 'none';
                    }
                    
                    // Apply comprehensive style overrides to match HTML exactly
                    
                    // Content area
                    const contents = clonedDoc.querySelectorAll('.content');
                    contents.forEach(content => {
                        content.style.setProperty('padding', '80px 60px 0', 'important');
                        content.style.setProperty('gap', '40px', 'important');
                        content.style.setProperty('font-size', '37px', 'important');
                        content.style.setProperty('line-height', '1.5', 'important');
                    });
                    
                    // Header text (title cards)
                    const headerTexts = clonedDoc.querySelectorAll('.header-text');
                    headerTexts.forEach(headerText => {
                        headerText.style.setProperty('font-size', '93px', 'important'); // 2.2em * 37px + adjustment
                        headerText.style.setProperty('font-weight', '800', 'important');
                        headerText.style.setProperty('color', '#2c3e50', 'important');
                        headerText.style.setProperty('line-height', '1.2', 'important');
                        headerText.style.setProperty('letter-spacing', '-0.02em', 'important');
                        headerText.style.setProperty('margin', '0', 'important');
                    });
                    
                    // Card headers
                    const cardHeaders = clonedDoc.querySelectorAll('.card-header');
                    cardHeaders.forEach(cardHeader => {
                        cardHeader.style.setProperty('font-size', '65px', 'important'); // 1.6em * 37px + adjustment
                        cardHeader.style.setProperty('font-weight', '700', 'important');
                        cardHeader.style.setProperty('color', '#2c3e50', 'important');
                        cardHeader.style.setProperty('line-height', '1.3', 'important');
                        cardHeader.style.setProperty('margin', '0 0 32px 0', 'important');
                    });
                    
                    // Section numbers
                    const sectionNumbers = clonedDoc.querySelectorAll('.section-number');
                    sectionNumbers.forEach(sectionNumber => {
                        sectionNumber.style.setProperty('font-size', '56px', 'important'); // 1.4em * 37px + adjustment
                        sectionNumber.style.setProperty('font-weight', '600', 'important');
                        sectionNumber.style.setProperty('color', '#2c3e50', 'important');
                        sectionNumber.style.setProperty('line-height', '1.3', 'important');
                        sectionNumber.style.setProperty('margin', '0 0 18px 0', 'important');
                    });
                    
                    // Section titles
                    const sectionTitles = clonedDoc.querySelectorAll('.section-title');
                    sectionTitles.forEach(sectionTitle => {
                        sectionTitle.style.setProperty('font-size', '56px', 'important'); // 1.4em * 37px + adjustment
                        sectionTitle.style.setProperty('font-weight', '600', 'important');
                        sectionTitle.style.setProperty('color', '#2c3e50', 'important');
                        sectionTitle.style.setProperty('line-height', '1.3', 'important');
                        sectionTitle.style.setProperty('margin', '0 0 20px 0', 'important');
                    });
                    
                    // Section content and text
                    const sectionContents = clonedDoc.querySelectorAll('.section-content, .section-text');
                    sectionContents.forEach(sectionContent => {
                        sectionContent.style.setProperty('font-size', '42px', 'important'); // 1.1em * 37px + adjustment
                        sectionContent.style.setProperty('font-weight', '300', 'important');
                        sectionContent.style.setProperty('color', '#34495e', 'important');
                        sectionContent.style.setProperty('line-height', '1.5', 'important');
                        sectionContent.style.setProperty('margin', '0 0 32px 0', 'important');
                    });
                    
                    // Sections
                    const sections = clonedDoc.querySelectorAll('.section');
                    sections.forEach(section => {
                        section.style.setProperty('margin-bottom', '60px', 'important');
                    });
                    
                    // Mountain illustration - preserve aspect ratio for custom images
                    const mountainScenes = clonedDoc.querySelectorAll('.mountain-scene');
                    mountainScenes.forEach(mountainScene => {
                        // Check if this contains a custom image instead of SVG
                        const customImg = mountainScene.querySelector('img[alt="Custom slide image"]');
                        if (customImg) {
                            // For custom images, use a more flexible sizing approach
                            mountainScene.style.setProperty('width', '600px', 'important');
                            mountainScene.style.setProperty('height', '600px', 'important');
                            mountainScene.style.setProperty('display', 'flex', 'important');
                            mountainScene.style.setProperty('align-items', 'center', 'important');
                            mountainScene.style.setProperty('justify-content', 'center', 'important');
                        } else {
                            // For SVG illustrations, keep original sizing
                            mountainScene.style.setProperty('width', '600px', 'important');
                            mountainScene.style.setProperty('height', '600px', 'important');
                        }
                    });
                    
                    // Author section
                    const authorSections = clonedDoc.querySelectorAll('.author-section');
                    authorSections.forEach(authorSection => {
                        authorSection.style.setProperty('padding', '40px 60px 60px', 'important');
                        authorSection.style.setProperty('gap', '24px', 'important');
                        authorSection.style.setProperty('background', 'linear-gradient(to top, rgba(248, 249, 250, 1) 70%, rgba(248, 249, 250, 0.8) 85%, rgba(248, 249, 250, 0) 100%)', 'important');
                    });

                    // Divider
                    const dividers = clonedDoc.querySelectorAll('.divider');
                    dividers.forEach(divider => {
                        divider.style.setProperty('width', '400px', 'important');
                        divider.style.setProperty('height', '6px', 'important');
                        divider.style.setProperty('background', '#bdc3c7', 'important');
                        divider.style.setProperty('margin-bottom', '16px', 'important');
                    });

                    // Author name
                    const authorNames = clonedDoc.querySelectorAll('.author-name');
                    authorNames.forEach(authorName => {
                        authorName.style.setProperty('font-size', '32px', 'important');
                        authorName.style.setProperty('font-weight', '500', 'important');
                        authorName.style.setProperty('color', '#34495e', 'important');
                        authorName.style.setProperty('gap', '16px', 'important');
                        authorName.style.setProperty('margin', '0', 'important');
                    });

                    // Author avatar
                    const authorAvatars = clonedDoc.querySelectorAll('.author-avatar');
                    authorAvatars.forEach(avatar => {
                        avatar.style.setProperty('width', '80px', 'important');
                        avatar.style.setProperty('height', '80px', 'important');
                        avatar.style.setProperty('margin-top', '12px', 'important');
                        avatar.style.setProperty('box-shadow', '0 3px 12px rgba(0, 0, 0, 0.2)', 'important');
                    });
                    
                    // Remove any remaining gradients and ensure white background
                        const allElements = clonedDoc.querySelectorAll('*');
                        allElements.forEach(el => {
                            if (el.style) {
                            if (el.style.background && el.style.background.includes('gradient') && !el.classList.contains('author-section')) {
                                    el.style.background = '#ffffff';
                                }
                            if (el.style.backgroundImage && el.style.backgroundImage !== 'none' && !el.classList.contains('author-avatar')) {
                                    el.style.backgroundImage = 'none';
                                }
                            }
                        });
                    }
                });
                
                return canvas.toDataURL('image/png');
                
            } catch (error) {
            console.error('Image generation failed:', error);
            throw error;
            } finally {
                // Restore original styles
                Object.keys(originalStyles).forEach(key => {
                    if (originalStyles[key] !== undefined) {
                        card.style[key] = originalStyles[key];
                    } else {
                        card.style.removeProperty(key);
                    }
                });
            }
        };
    </script>
    <script>
        let editMode = false;
        const totalCards = 7; // This will be updated dynamically

        function toggleEditMode() {
            editMode = !editMode;
            const editToggleBtn = document.getElementById('editToggleBtn');
            const editModeIndicator = document.getElementById('editModeIndicator');
            const editableElements = document.querySelectorAll('.editable');

            if (editMode) {
                editToggleBtn.textContent = '💾 Zapisz';
                editToggleBtn.classList.add('active');
                editModeIndicator.classList.add('active');
                
                editableElements.forEach(element => {
                    element.setAttribute('contenteditable', 'true');
                });
            } else {
                editToggleBtn.textContent = '✏️ Edytuj';
                editToggleBtn.classList.remove('active');
                editModeIndicator.classList.remove('active');
                
                editableElements.forEach(element => {
                    element.setAttribute('contenteditable', 'false');
                    element.blur();
                });
            }
        }

        async function downloadCard(cardNumber) {
            const card = document.getElementById(`card${cardNumber}`);
            if (!card) {
                console.error(`Card ${cardNumber} not found`);
                return;
            }

            const controls = document.querySelector('.controls');
            const indicator = document.querySelector('.edit-mode-indicator');
            
            // Hide controls during export
            controls.style.display = 'none';
            indicator.style.display = 'none';
            
            try {
                // Wait for fonts to be ready
                await document.fonts?.ready;

            // Generate image
            const dataUrl = await window.generateCardImage(card);
            
            // Create download link
                const link = document.createElement('a');
            link.download = `card-${cardNumber}.png`;
            link.href = dataUrl;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

            } catch (error) {
            console.error('Download failed:', error);
            alert('Nie udało się pobrać karty. Spróbuj ponownie.');
            } finally {
            // Restore controls
                controls.style.display = 'flex';
                if (editMode) {
                    indicator.style.display = 'block';
                }
            }
        }
    </script>
</body>
</html>
